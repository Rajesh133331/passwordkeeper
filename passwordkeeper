<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CrudCrud Integration</title>
  <style>
    #table {
      border-collapse: collapse;
    }
    tr, th, td {
      border: 1px solid #dddddd;
      padding: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="input_data">
    <label id="mail">Enter Email: </label>
    <input type="email" id="email" required placeholder="enter mail"><br><br>
    <label id="pass">Password: </label>
    <input type="password" id="password" required placeholder="enter password"><br><br>
    <button id="submit" onclick="listdata()">Submit</button>
  </div>

  <br><br><br>
  <div>
    <table id="table">
      <tr>
        <th>Email Id</th>
        <th>Password</th>
        <th>Update/Delete</th>
      </tr>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <script>
    const API_URL = "https://crudcrud.com/api/983821cddc24426cbffffd3d8df00d82/rajeshdata";

    // Show data from CrudCrud on page load
    window.onload = fetchAndDisplay;

    function listdata() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const newUser = { email, password };

      // Saving to the crudcrud
      fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newUser)
      })
      .then(res => res.json())
      .then(data => {
        appendToTable(data);
        document.getElementById("email").value = "";
        document.getElementById("password").value = "";
      })
    }

    function fetchAndDisplay() {
      fetch(API_URL)
        .then(res => res.json())
        .then(dataArray => {
          dataArray.forEach(data => {
            appendToTable(data);
          });
        })
    }

    function appendToTable(data) {
      const tbody = document.getElementById("tbody");
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${data.email}</td>
        <td>${data.password}</td>
        <td>
          <button>Edit</button>
          <button>Delete</button>
        </td>
      `;

      tbody.appendChild(tr);

      const buttons = tr.getElementsByTagName("button");
      buttons[1].onclick = function () {
        fetch(`${API_URL}/${data._id}`, {
          method: "DELETE"
        })
        .then(() => {
          tbody.removeChild(tr);
        })
      };

      buttons[0].onclick = function () {
        document.getElementById("email").value = data.email;
        document.getElementById("password").value = data.password;

        fetch(`${API_URL}/${data._id}`, {
          method: "DELETE"
        })
        .then(() => {
          tbody.removeChild(tr);
        })
      };
    }
  </script>
</body>
</html>
